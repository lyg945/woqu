package com.paat.oa.woqu.service.impl;

import cn.hutool.core.date.DateUtil;
import cn.hutool.core.io.FileUtil;
import cn.hutool.http.Header;
import cn.hutool.http.HttpRequest;
import cn.hutool.json.JSONArray;
import cn.hutool.json.JSONObject;
import cn.hutool.json.JSONUtil;
import cn.hutool.log.Log;
import cn.hutool.log.LogFactory;
import com.paat.oa.woqu.service.OAService;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;
import org.springframework.util.StringUtils;

import java.net.HttpCookie;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

@Service
public class OAServiceImpl implements OAService {

    Log log = LogFactory.get();

    @Value("${oa}")
    String path;

    @Value("${_wcfl_}")
    String _wcfl_;

    @Value("${_wcf_}")
    String _wcf_;

    @Value("${name}")
    String name;


    @Override
    public void pullOA() {
        System.out.println("开始检查拉取打卡记录:"+DateUtil.now());
        //链式构建请求
        Map map = new HashMap<>();
        map.put("year", DateUtil.format(new Date(), "yyyy"));
        map.put("month",DateUtil.format(new Date(), "MM"));

        log.debug(JSONUtil.parseObj(map).toString());

        HttpCookie cookie = new HttpCookie("_wcf_",_wcf_);
        HttpCookie cookie2 = new HttpCookie("_wcfl_",_wcfl_);

        String result = "{\"result\":0,\"data\":{\"showSignTime\":true,\"noSignShowTitle\":true,\"gmtEmployed\":\"2017-07-18 00:00:00\",\"showOvertimeRange\":true,\"menus\":[{\"identity\":\"workdays\",\"style\":\"woqu-daySun\",\"title\":\"排班天数\"},{\"identity\":\"gooutdays\",\"style\":\"woqu-goout\",\"title\":\"外出天数\"},{\"identity\":\"tripdays\",\"style\":\"woqu-trip\",\"title\":\"出差天数\"},{\"identity\":\"overtimedays\",\"style\":\"woqu-overtime\",\"title\":\"加班工时\"},{\"identity\":\"leavedays\",\"style\":\"woqu-leave\",\"title\":\"请假天数\"},{\"identity\":\"latedays\",\"style\":\"woqu-late_early\",\"title\":\"迟到次数\"},{\"identity\":\"earlydays\",\"style\":\"woqu-late_early\",\"title\":\"早退次数\"},{\"identity\":\"nosigndays\",\"style\":\"woqu-no_sign\",\"title\":\"漏打卡\"},{\"identity\":\"legworktimes\",\"style\":\"woqu-legwork_sign\",\"title\":\"外勤次数\"}],\"attendance\":{\"dayDetails\":[],\"dayUnitList\":[{\"dateMillionSeconds\":1575043200000,\"minutes\":480},{\"dateMillionSeconds\":1575129600000,\"minutes\":480},{\"dateMillionSeconds\":1575216000000,\"minutes\":480},{\"dateMillionSeconds\":1575302400000,\"minutes\":480},{\"dateMillionSeconds\":1575388800000,\"minutes\":480},{\"dateMillionSeconds\":1575475200000,\"minutes\":480},{\"dateMillionSeconds\":1575561600000,\"minutes\":480},{\"dateMillionSeconds\":1575648000000,\"minutes\":480},{\"dateMillionSeconds\":1575734400000,\"minutes\":480},{\"dateMillionSeconds\":1575820800000,\"minutes\":480},{\"dateMillionSeconds\":1575907200000,\"minutes\":480},{\"dateMillionSeconds\":1575993600000,\"minutes\":480},{\"dateMillionSeconds\":1576080000000,\"minutes\":480},{\"dateMillionSeconds\":1576166400000,\"minutes\":480},{\"dateMillionSeconds\":1576252800000,\"minutes\":480},{\"dateMillionSeconds\":1576339200000,\"minutes\":480},{\"dateMillionSeconds\":1576425600000,\"minutes\":480},{\"dateMillionSeconds\":1576512000000,\"minutes\":480},{\"dateMillionSeconds\":1576598400000,\"minutes\":480},{\"dateMillionSeconds\":1576684800000,\"minutes\":480},{\"dateMillionSeconds\":1576771200000,\"minutes\":480},{\"dateMillionSeconds\":1576857600000,\"minutes\":480},{\"dateMillionSeconds\":1576944000000,\"minutes\":480},{\"dateMillionSeconds\":1577030400000,\"minutes\":480},{\"dateMillionSeconds\":1577116800000,\"minutes\":480},{\"dateMillionSeconds\":1577203200000,\"minutes\":480},{\"dateMillionSeconds\":1577289600000,\"minutes\":480},{\"dateMillionSeconds\":1577376000000,\"minutes\":480},{\"dateMillionSeconds\":1577462400000,\"minutes\":480},{\"dateMillionSeconds\":1577548800000,\"minutes\":480},{\"dateMillionSeconds\":1577635200000,\"minutes\":480},{\"dateMillionSeconds\":1577721600000,\"minutes\":480},{\"dateMillionSeconds\":1577808000000,\"minutes\":480}],\"days\":[{\"AFormatDay\":\"2019-12-01\",\"customDays\":0,\"date\":1575129600000,\"dayType\":\"offday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":false,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":0,\"shiftVersion\":0,\"timeRange\":0,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-02\",\"customDays\":1,\"date\":1575216000000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":480,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":1,\"timeRange\":1,\"trip\":false,\"workEnd\":1575295688000,\"workEnd1\":1575295688000,\"workStart\":1575253144000,\"workStart1\":1575253144000,\"workTime\":649},{\"AFormatDay\":\"2019-12-03\",\"customDays\":1,\"date\":1575302400000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":480,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":1,\"timeRange\":1,\"trip\":false,\"workEnd\":1575382454000,\"workEnd1\":1575382454000,\"workStart\":1575337632000,\"workStart1\":1575337632000,\"workTime\":687},{\"AFormatDay\":\"2019-12-04\",\"customDays\":1,\"date\":1575388800000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":480,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":1,\"timeRange\":1,\"trip\":false,\"workEnd\":1575468933000,\"workEnd1\":1575468933000,\"workStart\":1575423536000,\"workStart1\":1575423536000,\"workTime\":697},{\"AFormatDay\":\"2019-12-05\",\"customDays\":1,\"date\":1575475200000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":480,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":1,\"timeRange\":1,\"trip\":false,\"workEnd\":1575555013000,\"workEnd1\":1575555013000,\"workStart\":1575510520000,\"workStart1\":1575510520000,\"workTime\":682},{\"AFormatDay\":\"2019-12-06\",\"customDays\":1,\"date\":1575561600000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":480,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":1,\"timeRange\":1,\"trip\":false,\"workEnd\":1575636724000,\"workEnd1\":1575636724000,\"workStart\":1575596249000,\"workStart1\":1575596249000,\"workTime\":615},{\"AFormatDay\":\"2019-12-07\",\"customDays\":0,\"date\":1575648000000,\"dayType\":\"offday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":false,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":0,\"shiftVersion\":0,\"timeRange\":0,\"trip\":false,\"workEnd\":1575711766000,\"workEnd1\":1575711766000,\"workStart\":1575684389000,\"workStart1\":1575684389000,\"workTime\":456},{\"AFormatDay\":\"2019-12-08\",\"customDays\":0,\"date\":1575734400000,\"dayType\":\"offday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":false,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":0,\"shiftVersion\":0,\"timeRange\":0,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-09\",\"customDays\":1,\"date\":1575820800000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":480,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":1,\"timeRange\":1,\"trip\":false,\"workEnd\":1575901049000,\"workEnd1\":1575901049000,\"workStart\":1575857248000,\"workStart1\":1575857248000,\"workTime\":670},{\"AFormatDay\":\"2019-12-10\",\"customDays\":1,\"date\":1575907200000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":480,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":1,\"timeRange\":1,\"trip\":false,\"workEnd\":1575987279000,\"workEnd1\":1575987279000,\"workStart\":1575943583000,\"workStart1\":1575943583000,\"workTime\":668},{\"AFormatDay\":\"2019-12-11\",\"customDays\":1,\"date\":1575993600000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":480,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":1,\"timeRange\":1,\"trip\":false,\"workEnd\":1576073870000,\"workEnd1\":1576073870000,\"workStart\":1576030387000,\"workStart1\":1576030387000,\"workTime\":664},{\"AFormatDay\":\"2019-12-12\",\"customDays\":1,\"date\":1576080000000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":480,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":1,\"timeRange\":1,\"trip\":false,\"workEnd\":1576159458000,\"workEnd1\":1576159458000,\"workStart\":1576116117000,\"workStart1\":1576116117000,\"workTime\":663},{\"AFormatDay\":\"2019-12-13\",\"customDays\":1,\"date\":1576166400000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":480,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":1,\"timeRange\":1,\"trip\":false,\"workEnd\":1576240563000,\"workEnd1\":1576240563000,\"workStart\":1576201800000,\"workStart1\":1576201800000,\"workTime\":586},{\"AFormatDay\":\"2019-12-14\",\"customDays\":0,\"date\":1576252800000,\"dayType\":\"offday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":false,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":0,\"shiftVersion\":0,\"timeRange\":0,\"trip\":false,\"workEnd\":1576316596000,\"workEnd1\":1576316596000,\"workStart\":1576289290000,\"workStart1\":1576289290000,\"workTime\":455},{\"AFormatDay\":\"2019-12-15\",\"customDays\":0,\"date\":1576339200000,\"dayType\":\"offday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":false,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":0,\"shiftVersion\":0,\"timeRange\":0,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-16\",\"customDays\":1,\"date\":1576425600000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":0,\"timeRange\":1,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-17\",\"customDays\":1,\"date\":1576512000000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":0,\"timeRange\":1,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-18\",\"customDays\":1,\"date\":1576598400000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":0,\"timeRange\":1,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-19\",\"customDays\":1,\"date\":1576684800000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":0,\"timeRange\":1,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-20\",\"customDays\":1,\"date\":1576771200000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":0,\"timeRange\":1,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-21\",\"customDays\":0,\"date\":1576857600000,\"dayType\":\"offday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":false,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":0,\"shiftVersion\":0,\"timeRange\":0,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-22\",\"customDays\":0,\"date\":1576944000000,\"dayType\":\"offday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":false,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":0,\"shiftVersion\":0,\"timeRange\":0,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-23\",\"customDays\":1,\"date\":1577030400000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":0,\"timeRange\":1,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-24\",\"customDays\":1,\"date\":1577116800000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":0,\"timeRange\":1,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-25\",\"customDays\":1,\"date\":1577203200000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":0,\"timeRange\":1,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-26\",\"customDays\":1,\"date\":1577289600000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":0,\"timeRange\":1,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-27\",\"customDays\":1,\"date\":1577376000000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":0,\"timeRange\":1,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-28\",\"customDays\":0,\"date\":1577462400000,\"dayType\":\"offday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":false,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":0,\"shiftVersion\":0,\"timeRange\":0,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-29\",\"customDays\":0,\"date\":1577548800000,\"dayType\":\"offday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":false,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":0,\"shiftVersion\":0,\"timeRange\":0,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-30\",\"customDays\":1,\"date\":1577635200000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":0,\"timeRange\":1,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2019-12-31\",\"customDays\":1,\"date\":1577721600000,\"dayType\":\"workday\",\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":true,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftId\":7,\"shiftType\":\"office\",\"shiftVersion\":0,\"timeRange\":1,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2020-01-01\",\"customDays\":0,\"date\":1577808000000,\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":false,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftVersion\":0,\"timeRange\":0,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2020-01-02\",\"customDays\":0,\"date\":1577894400000,\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":false,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftVersion\":0,\"timeRange\":0,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2020-01-03\",\"customDays\":0,\"date\":1577980800000,\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":false,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftVersion\":0,\"timeRange\":0,\"trip\":false,\"workTime\":0},{\"AFormatDay\":\"2020-01-04\",\"customDays\":0,\"date\":1578067200000,\"delayWorkTime\":0,\"early\":0,\"early1\":0,\"early2\":0,\"early3\":0,\"early4\":0,\"earlyClearup\":false,\"earlyClearup1\":false,\"earlyClearup2\":false,\"earlyClearup3\":false,\"earlyClearup4\":false,\"goout\":false,\"late\":0,\"late1\":0,\"late2\":0,\"late3\":0,\"late4\":0,\"lateClearup\":false,\"lateClearup1\":false,\"lateClearup2\":false,\"lateClearup3\":false,\"lateClearup4\":false,\"leave\":false,\"needSignIn\":false,\"nosignTime\":0,\"outWorkTime\":0,\"overtime\":false,\"removeEarlyMinute\":0,\"removeEarlyTime\":0,\"removeLateMinute\":0,\"removeLateTime\":0,\"shiftVersion\":0,\"timeRange\":0,\"trip\":false,\"workTime\":0}],\"goouts\":[],\"leaves\":[],\"legworks\":[],\"month\":12,\"overtimes\":[],\"shifts\":[{\"acrossIndex\":0,\"acrossTheDay\":\"NO\",\"advanceSetting\":\"late_start_work\",\"endTimeName\":\"白班\",\"endTimeName1\":\"白班\",\"halfShift\":false,\"shiftEnd\":36000000,\"shiftEnd1\":36000000,\"shiftId\":7,\"shiftName\":\"弹性班次（通）\",\"shiftShortName\":\"弹\",\"shiftStart\":3600000,\"shiftStart1\":3600000,\"shiftType\":\"office\",\"shiftVersion\":1,\"signInCount\":2,\"startTimeName\":\"白班\",\"startTimeName1\":\"白班\",\"timeRange\":1,\"timeoutEnd1\":18000000,\"timeoutRange\":1,\"timeoutStart1\":14400000,\"worktime\":480},{\"acrossIndex\":0,\"acrossTheDay\":\"NO\",\"advanceSetting\":\"late_start_work\",\"endTimeName\":\"白班\",\"endTimeName1\":\"白班\",\"halfShift\":false,\"shiftEnd\":36000000,\"shiftEnd1\":36000000,\"shiftId\":7,\"shiftName\":\"弹性班次（通）\",\"shiftShortName\":\"弹\",\"shiftStart\":3600000,\"shiftStart1\":3600000,\"shiftType\":\"office\",\"shiftVersion\":0,\"signInCount\":2,\"startTimeName\":\"白班\",\"startTimeName1\":\"白班\",\"timeRange\":1,\"timeoutEnd1\":18000000,\"timeoutRange\":1,\"timeoutStart1\":14400000,\"worktime\":480}],\"showNoSign\":\"YES\",\"trips\":[],\"year\":2019}},\"message\":\"操作成功\"}\n";
        result = HttpRequest.post("https://app.woqu365.com/app/employee/myAttendanceData.htm")
                .header(Header.USER_AGENT, "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit /537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36")//头信息，多个头信息多次调用此方法即可
                .cookie(cookie,cookie2)
                .form(map)
                .timeout(20000)//超时，毫秒
                .execute().body();

        log.debug(result);

        if(!StringUtils.isEmpty(result)){
            FileUtil.touch(path);
            FileUtil.writeUtf8String(result,path);
        }
    }


    @Override
    public void sendMsg(int i) {
        System.out.println("开始检查-打卡记录:"+DateUtil.now());

        String content = FileUtil.readUtf8String(path);
        JSONArray days = JSONUtil.parseObj(content).getJSONObject("data").
                                getJSONObject("attendance").getJSONArray("days");
       for (Object day : days) {
            JSONObject obj = (JSONObject) day;
            if(DateUtil.format(new Date(), "yyyy-MM-dd").equals(obj.getStr("AFormatDay"))
            && "workday".equals(obj.getStr("dayType"))
            ){
                if(1 == i && StringUtils.isEmpty(obj.getStr("workStart"))){
                    send(name,obj.getStr("AFormatDay"),"上班");
                }

                if(2 == i && StringUtils.isEmpty(obj.getStr("workEnd"))){
                    send(name,obj.getStr("AFormatDay"),"下班");
                }
            }
        }
    }

    private void send(String name,String date,String day){
        JSONObject json = JSONUtil.parseObj("{\"msgtype\":\"markdown\"," +
                "\"markdown\":{\"content\":\""+name+"—"+date+"—<font color=\\\"warning\\\">未打"+day+"卡</font>\"}}");
        HttpRequest.post("https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=6f8fee88-0281-4da8-b1be-d120d296d606")
                .body(json.toString())
                .timeout(20000)//超时，毫秒
                .execute().body();
    }
}
